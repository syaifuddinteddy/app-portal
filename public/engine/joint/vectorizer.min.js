/*! JointJS v0.9.3 - JavaScript diagramming library  2015-05-22 

This Source Code Form is subject to the terms of the Mozilla Public
License, v. 2.0. If a copy of the MPL was not distributed with this
file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Vectorizer=a.V=b()}}}(this,function(){var i=typeof window==="object"&&!!(window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));if(!i){return function(){}}var w={xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};var a="1.1";var m=0;function o(){var x=++m+"";return"v-"+x}function c(y){var x='<svg xmlns="'+w.xmlns+'" xmlns:xlink="'+w.xlink+'" version="'+a+'">'+(y||"")+"</svg>";var z=new DOMParser();z.async=false;return z.parseFromString(x,"text/xml").documentElement}function t(z,F,A){var B,C;if(!z){return undefined}if(typeof z==="object"){return new e(z)}F=F||{};if(z.toLowerCase()==="svg"){return new e(c())}else{if(z[0]==="<"){var G=c(z);if(G.childNodes.length>1){var D=[];for(B=0,C=G.childNodes.length;B<C;B++){var x=G.childNodes[B];D.push(new e(document.importNode(x,true)))}return D}return new e(document.importNode(G.firstChild,true))}}z=document.createElementNS(w.xmlns,z);for(var E in F){v(z,E,F[E])}if(Object.prototype.toString.call(A)!="[object Array]"){A=[A]}for(B=0,C=(A[0]&&A.length)||0;B<C;B++){var y=A[B];z.appendChild(y instanceof e?y.node:y)}return new e(z)}function v(z,y,A){if(y.indexOf(":")>-1){var x=y.split(":");z.setAttributeNS(w[x[0]],x[1],A)}else{if(y==="id"){z.id=A}else{z.setAttribute(y,A)}}}function j(x){var y,B,z;if(x){var C=/[ ,]+/;var F=x.match(/translate\((.*)\)/);if(F){y=F[1].split(C)}var D=x.match(/rotate\((.*)\)/);if(D){B=D[1].split(C)}var A=x.match(/scale\((.*)\)/);if(A){z=A[1].split(C)}}var E=(z&&z[0])?parseFloat(z[0]):1;return{translate:{tx:(y&&y[0])?parseInt(y[0],10):0,ty:(y&&y[1])?parseInt(y[1],10):0},rotate:{angle:(B&&B[0])?parseInt(B[0],10):0,cx:(B&&B[1])?parseInt(B[1],10):undefined,cy:(B&&B[2])?parseInt(B[2],10):undefined},scale:{sx:E,sy:(z&&z[1])?parseFloat(z[1]):E}}}function n(A,x){var z=x.x*A.a+x.y*A.c+0;var y=x.x*A.b+x.y*A.d+0;return{x:z,y:y}}function l(x){var B=n(x,{x:0,y:1});var z=n(x,{x:1,y:0});var A=((180/Math.PI)*Math.atan2(B.y,B.x)-90);var y=((180/Math.PI)*Math.atan2(z.y,z.x));return{translateX:x.e,translateY:x.f,scaleX:Math.sqrt(x.a*x.a+x.b*x.b),scaleY:Math.sqrt(x.c*x.c+x.d*x.d),skewX:A,skewY:y,rotation:A}}function e(x){this.node=x;if(!this.node.id){this.node.id=o()}}e.prototype={translate:function(z,x,D){D=D||{};x=x||0;var y=this.attr("transform")||"";var A=j(y);if(typeof z==="undefined"){return A.translate}y=y.replace(/translate\([^\)]*\)/g,"").trim();var E=D.absolute?z:A.translate.tx+z;var C=D.absolute?x:A.translate.ty+x;var B="translate("+E+","+C+")";this.attr("transform",(B+" "+y).trim());return this},rotate:function(B,C,A,x){x=x||{};var z=this.attr("transform")||"";var y=j(z);if(typeof B==="undefined"){return y.rotate}z=z.replace(/rotate\([^\)]*\)/g,"").trim();B%=360;var E=x.absolute?B:y.rotate.angle+B;var F=(C!==undefined&&A!==undefined)?","+C+","+A:"";var D="rotate("+E+F+")";this.attr("transform",(z+" "+D).trim());return this},scale:function(B,z){z=(typeof z==="undefined")?B:z;var x=this.attr("transform")||"";var y=j(x);if(typeof B==="undefined"){return y.scale}x=x.replace(/scale\([^\)]*\)/g,"").trim();var A="scale("+B+","+z+")";this.attr("transform",(x+" "+A).trim());return this},bbox:function(z,B){if(!this.node.ownerSVGElement){return{x:0,y:0,width:0,height:0}}var y;try{y=this.node.getBBox();y={x:y.x|0,y:y.y|0,width:y.width|0,height:y.height|0}}catch(A){y={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(z){return y}var x=this.node.getTransformToElement(B||this.node.ownerSVGElement);return f.transformRect(y,x)},text:function(C,y){y=y||{};var G=C.split("\n");var B=0;var E;this.attr("y","0.8em");this.attr("display",C?null:"none");this.node.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");this.node.textContent="";var z=this.node;if(y.textPath){var A=this.find("defs");if(A.length===0){A=t("defs");this.append(A)}var D=Object(y.textPath)===y.textPath?y.textPath.d:y.textPath;if(D){var F=t("path",{d:D});A.append(F)}var x=t("textPath");if(!y.textPath["xlink:href"]&&F){x.attr("xlink:href","#"+F.node.id)}if(Object(y.textPath)===y.textPath){x.attr(y.textPath)}this.append(x);z=x.node}if(G.length===1){z.textContent=C;return this}for(;B<G.length;B++){E=f("tspan",{dy:(B==0?"0em":y.lineHeight||"1em"),x:this.attr("x")||0});E.addClass("v-line");if(!G[B]){E.addClass("v-empty-line")}E.node.textContent=G[B]||" ";f(z).append(E)}return this},attr:function(z,C){if(typeof z==="undefined"){var x=this.node.attributes;var y={};for(var B=0;B<x.length;B++){y[x[B].nodeName]=x[B].nodeValue}return y}if(typeof z==="string"&&typeof C==="undefined"){return this.node.getAttribute(z)}if(typeof z==="object"){for(var A in z){if(z.hasOwnProperty(A)){v(this.node,A,z[A])}}}else{v(this.node,z,C)}return this},remove:function(){if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}},append:function(A){var z=A;if(Object.prototype.toString.call(A)!=="[object Array]"){z=[A]}for(var y=0,x=z.length;y<x;y++){A=z[y];this.node.appendChild(A instanceof e?A.node:A)}return this},prepend:function(x){this.node.insertBefore(x instanceof e?x.node:x,this.node.firstChild)},svg:function(){return this.node instanceof window.SVGSVGElement?this:f(this.node.ownerSVGElement)},defs:function(){var x=this.svg().node.getElementsByTagName("defs");return(x&&x.length)?f(x[0]):undefined},clone:function(){var x=f(this.node.cloneNode(true));x.node.id=o();return x},findOne:function(x){var y=this.node.querySelector(x);return y?f(y):undefined},find:function(y){var z=this.node.querySelectorAll(y);for(var A=0,x=z.length;A<x;A++){z[A]=f(z[A])}return z},index:function(){var x=0;var y=this.node.previousSibling;while(y){if(y.nodeType===1){x++}y=y.previousSibling}return x},toLocalPoint:function(A,F){var B=this.svg().node;var E=B.createSVGPoint();E.x=A;E.y=F;try{var D=E.matrixTransform(B.getScreenCTM().inverse());var z=this.node.getTransformToElement(B).inverse()}catch(C){return E}return D.matrixTransform(z)},translateCenterToPoint:function(y){var z=this.bbox();var x=g.rect(z).center();this.translate(y.x-x.x,y.y-x.y)},translateAndAutoOrient:function(F,B,G){var K=this.scale();this.attr("transform","");this.scale(K.sx,K.sy);var E=this.svg().node;var I=this.bbox(false,G);var D=E.createSVGTransform();D.setTranslate(-I.x-I.width/2,-I.y-I.height/2);var z=E.createSVGTransform();var A=g.point(F).changeInAngle(F.x-B.x,F.y-B.y,B);z.setRotate(A,0,0);var H=E.createSVGTransform();var J=g.point(F).move(B,I.width/2);H.setTranslate(F.x+(F.x-J.x),F.y+(F.y-J.y));var C=this.node.getTransformToElement(G);var y=E.createSVGTransform();y.setMatrix(H.matrix.multiply(z.matrix.multiply(D.matrix.multiply(C))));var x=l(y.matrix);this.translate(x.translateX,x.translateY);this.rotate(x.rotation);return this},animateAlongPath:function(H,I){var D=f("animateMotion",H);var B=f("mpath",{"xlink:href":"#"+f(I).node.id});D.append(B);this.append(D);try{D.node.beginElement()}catch(G){if(document.documentElement.getAttribute("smiling")==="fake"){var z=D.node;z.animators=[];var y=z.getAttribute("id");if(y){id2anim[y]=z}var E=getTargets(z);for(var A=0,C=E.length;A<C;A++){var F=E[A];var x=new Animator(z,F,A);animators.push(x);z.animators[A]=x;x.register()}}}},hasClass:function(x){return new RegExp("(\\s|^)"+x+"(\\s|$)").test(this.node.getAttribute("class"))},addClass:function(y){if(!this.hasClass(y)){var x=this.node.getAttribute("class")||"";this.node.setAttribute("class",(x+" "+y).trim())}return this},removeClass:function(x){if(this.hasClass(x)){var y=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+x+"(\\s|$)","g"),"$2");this.node.setAttribute("class",y)}return this},toggleClass:function(z,x){var y=typeof x==="undefined"?this.hasClass(z):!x;if(y){this.removeClass(z)}else{this.addClass(z)}return this},sample:function(x){x=x||1;var B=this.node;var A=B.getTotalLength();var y=[];var C=0;var z;while(C<A){z=B.getPointAtLength(C);y.push({x:z.x,y:z.y,distance:C});C+=x}return y},convertToPath:function(){var x=t("path");x.attr(this.attr());var y=this.convertToPathData();if(y){x.attr("d",y)}return x},convertToPathData:function(){var x=this.node.tagName.toUpperCase();switch(x){case"PATH":return this.attr("d");case"LINE":return k(this.node);case"POLYGON":return u(this.node);case"POLYLINE":return q(this.node);case"ELLIPSE":return p(this.node);case"CIRCLE":return s(this.node);case"RECT":return b(this.node)}throw new Error(x+" cannot be converted to PATH.")},findIntersection:function(C,T){var K=this.svg().node;T=T||K;var x=g.rect(this.bbox(false,T));var R=x.center();var E=x.intersectionWithLineFromCenterToPoint(C);if(!E){return undefined}var A=this.node.localName.toUpperCase();if(A==="RECT"){var Q=g.rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height")));var P=this.node.getTransformToElement(T);var D=f.decomposeMatrix(P);var F=K.createSVGTransform();F.setRotate(-D.rotation,R.x,R.y);var z=f.transformRect(Q,F.matrix.multiply(P));E=g.rect(z).intersectionWithLineFromCenterToPoint(C,D.rotation)}else{if(A==="PATH"||A==="POLYGON"||A==="POLYLINE"||A==="CIRCLE"||A==="ELLIPSE"){var G=(A==="PATH")?this:this.convertToPath();var I=G.sample();var H=Infinity;var J=[];for(var M=0,O=I.length;M<O;M++){var N=I[M];var L=f.createSVGPoint(N.x,N.y);L=L.matrixTransform(this.node.getTransformToElement(T));N=g.point(L);var y=N.distance(R);var S=N.distance(C)*1.1;var B=y+S;if(B<H){H=B;J=[{sample:N,refDistance:S}]}else{if(B<H+1){J.push({sample:N,refDistance:S})}}}J.sort(function(V,U){return V.refDistance-U.refDistance});E=J[0].sample}}return E}};function k(x){x=t(x);var y=["M",x.attr("x1"),x.attr("y1"),"L",x.attr("x2"),x.attr("y2")].join(" ");return y}function u(y){y=t(y);var z=y.node.points;var B=[];var A;for(var x=0;x<z.length;x++){A=z[x];B.push(x===0?"M":"L",A.x,A.y)}B.push("Z");return B.join(" ")}function q(x){x=t(x);var z=x.node.points;var B=[];var A;for(var y=0;y<z.length;y++){A=z[y];B.push(y===0?"M":"L",A.x,A.y)}return B.join(" ")}var d=0.5522847498307935;function s(z){z=t(z);var x=parseFloat(z.attr("cx"))||0;var C=parseFloat(z.attr("cy"))||0;var y=parseFloat(z.attr("r"));var B=y*d;var A=["M",x,C-y,"C",x+B,C-y,x+y,C-B,x+y,C,"C",x+y,C+B,x+B,C+y,x,C+y,"C",x-B,C+y,x-y,C+B,x-y,C,"C",x-y,C-B,x-B,C-y,x,C-y,"Z"].join(" ");return A}function p(A){A=t(A);var x=parseFloat(A.attr("cx"))||0;var E=parseFloat(A.attr("cy"))||0;var C=parseFloat(A.attr("rx"));var B=parseFloat(A.attr("ry"))||C;var z=C*d;var y=B*d;var D=["M",x,E-B,"C",x+z,E-B,x+C,E-y,x+C,E,"C",x+C,E+y,x+z,E+B,x,E+B,"C",x-z,E+B,x-C,E+y,x-C,E,"C",x-C,E-y,x-z,E-B,x,E-B,"Z"].join(" ");return D}function b(G){G=t(G);var H=parseFloat(G.attr("x"))||0;var F=parseFloat(G.attr("y"))||0;var C=parseFloat(G.attr("width"))||0;var J=parseFloat(G.attr("height"))||0;var B=parseFloat(G.attr("rx"))||0;var A=parseFloat(G.attr("ry"))||0;var I=g.rect(H,F,C,J);var D;if(!B&&!A){D=["M",I.origin().x,I.origin().y,"H",I.corner().x,"V",I.corner().y,"H",I.origin().x,"V",I.origin().y,"Z"].join(" ")}else{var z=H+C;var E=F+J;D=["M",H+B,F,"L",z-B,F,"Q",z,F,z,F+A,"L",z,F+J-A,"Q",z,E,z-B,E,"L",H+B,E,"Q",H,E,H,E-B,"L",H,F+A,"Q",H,F,H+B,F,"Z"].join(" ")}return D}function h(B){var A=B.rx||B["top-rx"]||0;var z=B.rx||B["bottom-rx"]||0;var y=B.ry||B["top-ry"]||0;var x=B.ry||B["bottom-ry"]||0;return["M",B.x,B.y+y,"v",B.height-y-x,"a",z,x,0,0,0,z,x,"h",B.width-2*z,"a",z,x,0,0,0,z,-x,"v",-(B.height-x-y),"a",A,y,0,0,0,-A,-y,"h",-(B.width-2*A),"a",A,y,0,0,0,-A,y].join(" ")}var f=t;f.decomposeMatrix=l;f.rectToPath=h;var r=f("svg").node;f.createSVGMatrix=function(x){var z=r.createSVGMatrix();for(var y in x){z[y]=x[y]}return z};f.createSVGTransform=function(){return r.createSVGTransform()};f.createSVGPoint=function(z,B){var A=r.createSVGPoint();A.x=z;A.y=B;return A};f.transformRect=function(y,H){var A=r.createSVGPoint();A.x=y.x;A.y=y.y;var G=A.matrixTransform(H);A.x=y.x+y.width;A.y=y.y;var E=A.matrixTransform(H);A.x=y.x+y.width;A.y=y.y+y.height;var D=A.matrixTransform(H);A.x=y.x;A.y=y.y+y.height;var B=A.matrixTransform(H);var F=Math.min(G.x,E.x,D.x,B.x);var z=Math.max(G.x,E.x,D.x,B.x);var C=Math.min(G.y,E.y,D.y,B.y);var x=Math.max(G.y,E.y,D.y,B.y);return{x:F,y:C,width:z-F,height:x-C}};return f}));